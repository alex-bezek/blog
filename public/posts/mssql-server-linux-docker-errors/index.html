<!DOCTYPE html>
<html>
  <head>
    <title>Microsoft SQL Server Linux Docker Errors</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
<link rel="stylesheet" href="/assets/css/layouts/main.css" />
<link rel="stylesheet" href="/assets/css/style.css" />
<link rel="stylesheet" href="/assets/css/navigators/navbar.css" />


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="https://alexbezek.io/images/logo/logo-transparent.png" />


<link rel="stylesheet" href="/assets/css/style.css" />

    
<meta name="description" content="A common issue using Microsoft SQL Server&#39;s Docker container" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/assets/css/layouts/single.css" />
<link rel="stylesheet" href="/assets/css/navigators/sidebar.css">


    
    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-135069512-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    


  


  


<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="https://alexbezek.io/images/logo/logo-transparent.png">Alex Bezek&#39;s Blog</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="https://alexbezek.io/images/logo/logo-transparent.png" class="d-none" id="main-logo">
  <img src="https://alexbezek.io/images/logo/logo-transparent.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="https://alexbezek.ioposts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/linking-to-local-images-in-gatsby-frontmatter/">Gatsby Frontmatter Local Images</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/react-jsx/">Jsx vs JS</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/mssql-server-linux-docker-errors/">Microsoft SQL Server Linux Docker Errors</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/rails-environment-vs-deploy-environment/">Rails Environment VS Deploy Environment</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://alexbezek.io/images/posts/mssql-server-linux-docker-errors/SQL-Loves-Linux_2_Twitter-002.png);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/assets/images/default-avatar.png'/>
          <h5 class="author-name"></h5>
          <p>October 10, 2017</p>
        </div>

        <div class="title">
          <h1>Microsoft SQL Server Linux Docker Errors</h1>
        </div>

        <div class="post-content" id="post-content">
          <p>Microsoft SQL Server in a linux based container&hellip;WHAAAAA? Thats rights. This may be old news for some, but Microsoft released a Docker image that allows you to run a MSSQL in a docker on your mac (or linux based) computer. Probably small news for most people, but for our team it was kind of awesome.</p>
<h4 id="background">Background</h4>
<p>My team&rsquo;s current project has been to create a new Rails based application on top of an existing .Net SQL server. Thankfully, rails (and its community) is awesome and implements an adapter type interface to Active Record, and a corresponding gem to implement that interface. <a href="https://github.com/rails-sqlserver/activerecord-sqlserver-adapter">https://github.com/rails-sqlserver/activerecord-sqlserver-adapter</a></p>
<p>So along with this idea of setting a rails service over a .Net database (cringe worthy to some I&rsquo;m sure), I also made the decision to make our UNIT tests hit our database&hellip; If you haven&rsquo;t hit <code>ctr + w</code> to close this post yet, bear with me. I swear I had reasons&hellip;I made 30+ models, mapping to our tables, and using <a href="https://github.com/thoughtbot/shoulda-matchers">shoulda matchers</a> (an awesome library for your model tests if you haven&rsquo;t tried it) which verifies all your models and their relations in memory. Boot up <code>rails console</code>, lo and behold nothing works. So unfortunately, most of our tests have to hit our legacy DB to have much validity to them. We also have lots of untested constraints, functions, and stored procedures we want to verify.</p>
<h4 id="what-we-had-to-deal-with">What we had to deal with</h4>
<p>So when we build a rails service that depends on a database that can only run on windows device what happens? Well your development environment and unit test environment also depend on that environment. Not a big deal when you have 5 people working. But when that group expands you have to adapt.</p>
<h4 id="what-happened">What happened</h4>
<p>With this idea, we had a small man group of 5 engineers, working together, coordinating when pushes and test would happen, and over the course of 6 months our engineering team exploded into over 30+ engineers needing to contribute to this repository. Do you know what happens when someone running a test against a shared DB executes a <code>ctrl z</code>? Well if its in the middle of a rspec unit test (which locks a table so it can roll it back for unit test purposes) it locks the table from everyone else. Needless to say, this cause lots of issues&hellip;</p>
<p>So we eventually knowledge transfer to everyone and explain how doing that is bad. But we still get a really annoying issue&hellip; We  have alot of associates in remote offices. If you try to run tests, they have to reach out to a remote server to do so. And they take up to 45  minutes now they say! That is just unbearable. Luckily&hellip; docker fixes it!</p>
<h4 id="the-technical-part">The Technical Part</h4>
<p>If you were googling for an answer, this part is it. To solve the shared DB issue, we found we could run a .NET Sql server locally in a docker container. Using <a href="https://hub.docker.com/r/microsoft/mssql-server-linux/">this docker image</a> we can pretty easily configure out schema inside it using a .bak file, and run tests locally against it. It does have a specific requirement that most people don&rsquo;t go read before trying to run our tests.</p>
<p><code>At least 3.25 GB of RAM. Make sure to assign enough memory to the Docker VM if you're running on Docker for Mac or Windows.</code></p>
<p>Unfortunately, docker is pretty new to most people on our team. More often than not, they boot the container, it fails, and people don&rsquo;t know why. Even if we tell them to update to use 4GB of ram, this <a href="https://github.com/docker/for-mac/issues/1354">github issue</a> is causing people issues whenever they update their docker version. So how do you troubleshoot this?</p>
<p>In a quickly growing team, my motto has be &ldquo;teach people how to fish, don&rsquo;t hand them the meat&rdquo;. If you boot a container and it fails, you just need to know how to gather the logs from it.</p>
<p>First, just find the container that died. <code>docker ps</code> shows all the running containers, but adding the flag <code>-a</code> also shows the killed ones</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">docker ps -a
cd26b6cac46a my_sqlserver:latest     <span style="color:#e6db74">&#34;/bin/sh -c /opt/m...&#34;</span>     <span style="color:#ae81ff">1</span> months ago Exited <span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>     <span style="color:#ae81ff">1</span> months ago SQLSERVER

</code></pre></div><p>From there you want to figure out why it died. If its a decent container (like microsoft&rsquo;s) the logs should tell you why. Using the <code>docker logs ${docker id}</code> command should pinpoint the issue.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">docker logs cd26b6cac46a
sqlservr: This program requires a machine with at least <span style="color:#ae81ff">3250</span> megabytes of memory.
</code></pre></div><p>So there you have it. A quite long winded article involving all my team&rsquo;s baggage, but hopefully pinpointing some issues not specific to us. If you get anything from this, let it not be how to troubleshoot a .Net SQLSever docker container, but rather how to troubleshoot your failing containers as a whole.</p>

        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/alex-bezek/blog/edit/master/content/posts/mssql-server-linux-docker-errors.md">
                <i class="fas fa-code-branch"></i>
                Improve This Page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/react-jsx/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Jsx vs Js</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/linking-to-local-images-in-gatsby-frontmatter/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>Linking to local images in Gatsby frontmatter</span>
          </a>
        </div>
      
    
  

  

  

</div>

      <hr />
      
      
          <div id="disqus_thread"></div>
<script type="text/javascript">
  (function () {
    
    
    if (window.location.hostname == "localhost") return;

    var dsq = document.createElement("script");
    dsq.type = "text/javascript";
    dsq.async = true;
    var disqus_shortname = "alexbezek";
    dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
    (
      document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0]
    ).appendChild(dsq);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
<a href="https://disqus.com/" class="dsq-brlink"
  >comments powered by <span class="logo-disqus">Disqus</span></a
>

      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
  </section>

    </div>

    

  




  




  
  
    
  


<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experiences</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#achievements">Achievements</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>alex.liam.bezek@gmail.com</span></li>
          
          <li><span>Phone: </span> <span>913-626-1909</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/assets/images/inverted-logo.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/assets/images/hugo-logo-wide.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/assets/js/jquery-3.4.1.min.js"></script>
<script src="/assets/js/popper.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>

<script src="/assets/js/navbar.js"></script>
<script src="/assets/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/assets/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
